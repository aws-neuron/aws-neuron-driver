// SPDX-License-Identifier: GPL-2.0
/*
 * Copyright 2022 Amazon.com, Inc. or its affiliates. All rights reserved.
 */

#ifndef __V3_ADDR_MAP_H__

// Host memory access
#define V3_PCIE_A0_BASE                        0x00400000000000ull

// Neighbor memory access
#define V3_PCIE_B0_0_BASE                      0x10000000000000ull
#define V3_PCIE_B0_1_BASE                      0x14000000000000ull
#define V3_PCIE_B0_2_BASE                      0x18000000000000ull
#define V3_PCIE_B0_3_BASE                      0x1c000000000000ull

// relative to nc
#define V3_MMAP_P_OFFSET 0x0000000d0000000ull
#define V3_MMAP_NC_EVENT_OFFSET 0x00000002700000ull
#define V3_MMAP_NC_SEMA_READ_OFFSET V3_MMAP_NC_EVENT_OFFSET + 0x00000000001000ull
#define V3_MMAP_NC_SEMA_SET_OFFSET V3_MMAP_NC_EVENT_OFFSET + 0x00000000001400ull
#define V3_MMAP_NC_SEMA_INCR_OFFSET V3_MMAP_NC_EVENT_OFFSET + 0x00000000001800ull
#define V3_MMAP_NC_SEMA_DECR_OFFSET V3_MMAP_NC_EVENT_OFFSET + 0x00000000001c00ull
#define V3_MMAP_NC_SEMA_SIZE 0x00000000002000ull


#define V3_PCIE_BAR0_APB_IO_0_OFFSET 0x000000000000000ull
#define V3_PCIE_BAR0_APB_IO_1_OFFSET 0x000000040000000ull
#define V3_PCIE_BAR0_APB_SE_0_OFFSET 0x000000080000000ull
#define V3_PCIE_BAR0_APB_SE_1_OFFSET 0x000000090000000ull
#define V3_PCIE_BAR0_APB_SE_2_OFFSET 0x0000000a0000000ull
#define V3_PCIE_BAR0_APB_SE_3_OFFSET 0x0000000b0000000ull
#define V3_PCIE_BAR0_APB_IO_0_SIZE   0x000000020000000ull


// relative to bar0
#define V3_APB_IO_0_USER_IO_RELBASE                0x00000006800000ull
#define V3_APB_IO_0_USER_IO_MISC_RAM_RELBASE       0x00000000484000ull

// relative to address space
#define V3_APB_MISC_RAM_OFFSET 0x00008006c84000ull

#define V3_MMAP_NC_SIZE 0x00000804000000ull

//
#define V3_NUM_DIE_PER_DEVICE 2
#define V3_NUM_SENG_PER_DIE   2
#define V3_SENG_PER_DEVICE    (V3_NUM_DIE_PER_DEVICE * V3_NUM_SENG_PER_DIE)

// Number of Neuron Core per device
#define V3_NC_PER_SENG 2
#define V3_NC_PER_DIE  (V3_NUM_SENG_PER_DIE * V3_NC_PER_SENG)
#define V3_NC_PER_DEVICE (V3_NC_PER_SENG * V3_SENG_PER_DEVICE)
// Number of DMA engines per NC
#define V3_DMA_ENG_PER_NC 16

// Number of DMA queues in each engine
#define V3_DMA_QUEUE_PER_ENG 16

#define V3_NUM_DMA_ENG_PER_SENG   (V3_NC_PER_SENG * V3_DMA_ENG_PER_NC)
#define V3_NUM_SENG_DMA_PER_DEVICE (V3_NC_PER_DEVICE * V3_DMA_ENG_PER_NC)
#define V3_NUM_H2D_DMA_PER_DEVICE 4
#define V3_NUM_DMA_ENG_PER_DEVICE (V3_NUM_SENG_DMA_PER_DEVICE + V3_NUM_H2D_DMA_PER_DEVICE)
#define V3_MAX_DMA_RINGS 16

// Number of TPB engines per NC
#define V3_TPB_ENG_PER_NC 5

// Number of TOP_SP
#define V3_TS_PER_NC     2
#define V3_TS_PER_DIE    (V3_NC_PER_DIE * V3_TS_PER_NC)
#define V3_TS_PER_DEVICE (V3_NC_PER_DEVICE * V3_TS_PER_NC)

// max channels supported by V3 device
#define V3_MAX_DRAM_CHANNELS 4

#define V3_SEMAPHORE_COUNT 256
#define V3_EVENTS_COUNT 256

#define V3_ALLOWED_DESC_PER_PACKET 64

#define V3_MAX_NQ_QUEUES 16
#define V3_MAX_NQ_TYPE 5
#define V3_MAX_NQ_SUPPORTED (V3_MAX_NQ_TYPE * V3_MAX_NQ_QUEUES)

#define V3_APB_IO_0_BASE 0x00008000000000ull
#define V3_APB_IO_1_BASE 0x00808000000000ull
#define V3_HBM_0_BASE 0x00000000000000ull
#define V3_HBM_1_BASE 0x00004000000000ull
#define V3_HBM_2_BASE 0x00800000000000ull
#define V3_HBM_3_BASE 0x00804000000000ull
#define V3_HBM_SIZE 0x001000000000ull
#define V3_HBM_ACTIVE_SIZE 0x600000000ull /* Each HBM stack is actually 24GB not 64GB as above define suggests */

#define V3_PREPROC_0_BASE  0x00001200000000ull
#define V3_PREPROC_1_BASE  0x00005200000000ull
#define V3_PREPROC_2_BASE  0x00801200000000ull
#define V3_PREPROC_3_BASE  0x00805200000000ull
#define V3_PREPROC_SIZE  0x000000034c0000ull

#define V3_MMAP_TPB_0_BASE 0x00002000000000ull
#define V3_MMAP_TPB_1_BASE 0x00003000000000ull
#define V3_MMAP_TPB_2_BASE 0x00006000000000ull
#define V3_MMAP_TPB_3_BASE 0x00007000000000ull
#define V3_MMAP_TPB_4_BASE 0x00802000000000ull
#define V3_MMAP_TPB_5_BASE 0x00803000000000ull
#define V3_MMAP_TPB_6_BASE 0x00806000000000ull
#define V3_MMAP_TPB_7_BASE 0x00807000000000ull

#define V3_PCIE_BAR0_TPB_0_OFFSET 0x0000000d0000000ull
#define V3_PCIE_BAR0_TPB_1_OFFSET 0x0000000d4000000ull
#define V3_PCIE_BAR0_TPB_2_OFFSET 0x0000000d8000000ull
#define V3_PCIE_BAR0_TPB_3_OFFSET 0x0000000dc000000ull
#define V3_PCIE_BAR0_TPB_4_OFFSET 0x0000000e0000000ull
#define V3_PCIE_BAR0_TPB_5_OFFSET 0x0000000e4000000ull
#define V3_PCIE_BAR0_TPB_6_OFFSET 0x0000000e8000000ull
#define V3_PCIE_BAR0_TPB_7_OFFSET 0x0000000ec000000ull
#define V3_PCIE_BAR0_TPB_SIZE 0x000000004000000ull
#define V3_PCIE_BAR0_TPB_DIST (V3_PCIE_BAR0_TPB_1_OFFSET - V3_PCIE_BAR0_TPB_0_OFFSET)
#define V3_PCIE_BAR0_TPB_SBUF_SIZE 0x000000002000000ull

#define V3_PCIE_BAR0_APB_IO_0_OFFSET 0x000000000000000ull
#define V3_PCIE_BAR0_APB_IO_1_OFFSET 0x000000040000000ull
#define V3_PCIE_BAR0_APB_IO_DIST (V3_PCIE_BAR0_APB_IO_1_OFFSET - V3_PCIE_BAR0_APB_IO_0_OFFSET)

#define V3_PCIE_BAR0_APB_SE_0_OFFSET 0x000000080000000ull
#define V3_PCIE_BAR0_APB_SE_1_OFFSET 0x000000090000000ull
#define V3_PCIE_BAR0_APB_SE_2_OFFSET 0x0000000a0000000ull
#define V3_PCIE_BAR0_APB_SE_3_OFFSET 0x0000000b0000000ull
#define V3_PCIE_BAR0_APB_SE_DIST (V3_PCIE_BAR0_APB_SE_1_OFFSET - V3_PCIE_BAR0_APB_SE_0_OFFSET)

#define V3_PCIE_BAR4_HBM_0_OFFSET 0x000000000000000
#define V3_PCIE_BAR4_HBM_1_OFFSET 0x000001000000000
#define V3_PCIE_BAR4_HBM_2_OFFSET 0x000002000000000
#define V3_PCIE_BAR4_HBM_3_OFFSET 0x000003000000000

#define V3_APB_SE_0_USER_FIS_SDMA_0_OFFSET 0x0000000c000000ull
#define V3_APB_SE_1_USER_FIS_SDMA_0_OFFSET 0x0000000c400000ull
#define V3_APB_SE_2_USER_FIS_SDMA_0_OFFSET 0x0000000c000000ull
#define V3_APB_SE_3_USER_FIS_SDMA_0_OFFSET 0x0000000c400000ull
#define V3_APB_SE_USER_FIS_SDMA_0_FIS_0_USER_ERRTRIG_OFFSET 0x00000000000000ull
#define V3_APB_SE_USER_FIS_SDMA_0_SIZE 0x00000000020000ull

#define V3_TOP_SP_SIZE    0x00000000400000ull
#define V3_TOP_SP_0_BASE  0x00008280000000ull
#define V3_TOP_SP_1_BASE  0x000082c0000000ull
#define V3_TOP_SP_2_BASE  0x00008300000000ull
#define V3_TOP_SP_3_BASE  0x00008340000000ull
#define V3_TOP_SP_4_BASE  0x00008380000000ull
#define V3_TOP_SP_5_BASE  0x000083c0000000ull
#define V3_TOP_SP_6_BASE  0x00008400000000ull
#define V3_TOP_SP_7_BASE  0x00008440000000ull
#define V3_TOP_SP_8_BASE  0x00008480000000ull
#define V3_TOP_SP_9_BASE  0x000084c0000000ull
#define V3_TOP_SP_10_BASE 0x00808280000000ull
#define V3_TOP_SP_11_BASE 0x008082c0000000ull
#define V3_TOP_SP_12_BASE 0x00808300000000ull
#define V3_TOP_SP_13_BASE 0x00808340000000ull
#define V3_TOP_SP_14_BASE 0x00808380000000ull
#define V3_TOP_SP_15_BASE 0x008083c0000000ull
#define V3_TOP_SP_16_BASE 0x00808400000000ull
#define V3_TOP_SP_17_BASE 0x00808440000000ull
#define V3_TOP_SP_18_BASE 0x00808480000000ull
#define V3_TOP_SP_19_BASE 0x008084c0000000ull
#define V3_TOP_SP_DIST   (V3_TOP_SP_1_BASE - V3_TOP_SP_0_BASE)

#define V3_PCIE_BAR0_TOP_SP_0_OFFSET  0x0000000f0000000ull
#define V3_PCIE_BAR0_TOP_SP_10_OFFSET 0x0000000f2800000ull
#define V3_PCIE_BAR0_TOP_SP_0_SIZE    0x000000000400000ull

#define V3_MMAP_TPB_COUNT 8
#define V3_NUM_DMA_ENGINES_PER_TPB 16

#define V3_D2H_0_IDX 128
#define V3_H2D_0_IDX 129
#define V3_D2H_1_IDX 130
#define V3_H2D_1_IDX 131

#define V3_APB_SE_0_BASE 0x00001000000000ull
#define V3_APB_SE_1_BASE 0x00005000000000ull
#define V3_APB_SE_2_BASE 0x00801000000000ull
#define V3_APB_SE_3_BASE 0x00805000000000ull
#define V3_APB_SDMA_DIST 0x00000000100000ull

#define V3_APB_SE_0_SDMA_0_BASE 0x00001002000000ull
#define V3_APB_SE_1_SDMA_0_BASE 0x00005004000000ull
#define V3_APB_SE_2_SDMA_0_BASE 0x00801002000000ull
#define V3_APB_SE_3_SDMA_0_BASE 0x00805004000000ull
#define V3_APB_SDMA_MISC_OFFSET 0x00000000040000ull

#define V3_APB_IO_0_D2H_UDMA_BASE   0x00008006800000ull
#define V3_APB_IO_0_H2D_UDMA_BASE   0x00008006900000ull
#define V3_APB_IO_1_D2H_UDMA_BASE   0x00808006800000ull
#define V3_APB_IO_1_H2D_UDMA_BASE   0x00808006900000ull

#define V3_APB_SENG_0_SDMA_0_NOTIFIC_RELBASE 0x00000000001000ull
#define V3_APB_IO_0_SE_0_RELBASE 0x00000006000000ull
#define V3_APB_IO_0_SE_1_RELBASE 0x00000006400000ull
#define V3_APB_IO_1_SE_0_RELBASE 0x00000006000000ull
#define V3_APB_IO_1_SE_1_RELBASE 0x00000006400000ull
#define V3_APB_IO_0_SE_0_TPB_0_SIZE 0x00000000180000ull
#define V3_APB_IO_0_SE_0_TPB_TOP_RELBASE 0x00000000000000ull
#define V3_APB_IO_0_SE_0_TPB_TOP_NOTIFIC_RELBASE 0x00000000001000ull
#define V3_APB_IO_0_SE_0_TPB_NOTIFIC_SIZE 0x00000000001000ull
#define V3_APB_SENG_0_SDMA_0_APP_RELBASE 0x00000000000000ull

#define V3_APB_IO_0_USER_IO_TOP_SP_0_RELBASE 0x00000000200000ull
#define V3_APB_IO_0_USER_IO_TOP_SP_0_SIZE 0x00000000040000ull
#define V3_APB_IO_0_USER_IO_TOP_SP_0_NOTIFIC_RELBASE 0x00000000000000ull

#define V3_MMAP_BAR0_APB_IO_0_MISC_RAM_OFFSET      V3_PCIE_BAR0_APB_IO_0_OFFSET + V3_APB_IO_0_USER_IO_RELBASE + V3_APB_IO_0_USER_IO_MISC_RAM_RELBASE

#define V3_APB_IO_0_USER_SE_0_RESERVED2_RELBASE 0x00000006300000ull

#define V3_APB_IO_0_USER_SE_0_TPB_0_PE_SEQ_CLUSTER_HOST_VISIBLE_BASE 0x00008006141000ull
#define V3_APB_IO_0_USER_SE_0_TPB_1_PE_SEQ_CLUSTER_HOST_VISIBLE_BASE 0x000080062c1000ull
#define V3_APB_IO_0_USER_SE_1_TPB_0_PE_SEQ_CLUSTER_HOST_VISIBLE_BASE 0x00008006541000ull
#define V3_APB_IO_0_USER_SE_1_TPB_1_PE_SEQ_CLUSTER_HOST_VISIBLE_BASE 0x000080066c1000ull
#define V3_APB_IO_1_USER_SE_0_TPB_0_PE_SEQ_CLUSTER_HOST_VISIBLE_BASE 0x00808006141000ull
#define V3_APB_IO_1_USER_SE_0_TPB_1_PE_SEQ_CLUSTER_HOST_VISIBLE_BASE 0x008080062c1000ull
#define V3_APB_IO_1_USER_SE_1_TPB_0_PE_SEQ_CLUSTER_HOST_VISIBLE_BASE 0x00808006541000ull
#define V3_APB_IO_1_USER_SE_1_TPB_1_PE_SEQ_CLUSTER_HOST_VISIBLE_BASE 0x008080066c1000ull

#define V3_TPB_ARR_SEQ_QUEUE_PERF_BASE_OFFSET 0x00000000000100ull
#define V3_TPB_ARR_SEQ_QUEUE_PERF_SIZE 0x00000000000030ull
#define V3_TPB_ARR_SEQ_QUEUE_PERF_MATMUL_ACTIVE_CYCLE_CNT_LSB_OFFSET 0x00000000000000ull
#define V3_TPB_ARR_SEQ_QUEUE_PERF_WL_ACTIVE_CYCLE_CNT_LSB_OFFSET 0x00000000000008ull
#define V3_TPB_ARR_SEQ_QUEUE_PERF_IDLE_CYCLE_CNT_LSB_OFFSET 0x00000000000010ull

#endif
